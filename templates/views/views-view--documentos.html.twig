{#
/**
 * @file
 * Theme override for the Documents listing view.
 *
 * Based on DocumentsView from App.tsx - table layout for documents.
 *
 * Available variables:
 * - rows: The view results.
 * - header: The optional header.
 * - exposed: The exposed form widgets.
 * - pager: The pager element.
 * - view: The view object.
 *
 * @see template_preprocess_views_view()
 */
#}

{% set type_classes = {
  'pdf': 'bg-red-100 text-red-600',
  'xlsx': 'bg-green-100 text-green-600',
  'xls': 'bg-green-100 text-green-600',
  'docx': 'bg-blue-100 text-blue-600',
  'doc': 'bg-blue-100 text-blue-600',
  'pptx': 'bg-orange-100 text-orange-600',
  'ppt': 'bg-orange-100 text-orange-600',
} %}

<div class="documents-view space-y-6 animate-fade-in">
  
  {# Header #}
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
    <h2 class="text-2xl font-bold text-gray-900">{{ 'Documentos e Arquivos'|t }}</h2>   
  </div>

  {# Exposed Filters (if any) #}
  {% if exposed %}
    <div class="card bg-white p-4 rounded-xl border border-gray-100">
      {{ exposed }}
    </div>
  {% endif %}

  {# Documents Table #}
  <div class="card bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="data-table w-full text-left text-sm text-gray-600">
        <thead class="bg-gray-50 text-gray-900 font-semibold border-b border-gray-200">
          <tr>
            <th class="px-6 py-4">{{ 'Nome'|t }}</th>
            <th class="px-6 py-4">{{ 'Categoria'|t }}</th>
            <th class="px-6 py-4">{{ 'Data de Atualização'|t }}</th>
            <th class="px-6 py-4">{{ 'Tamanho'|t }}</th>
            <th class="px-6 py-4 text-right">{{ 'Ação'|t }}</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% if view.result %}
            {% for row in view.result %}
              {% set node = row._entity %}
              {% set file = node.field_arquivo.entity %}
              {% set category = node.field_categoria.entity %}
              
              {# Get file extension #}
              {% set file_extension = '' %}
              {% if file %}
                {% set filename_parts = file.filename.value|split('.') %}
                {% set file_extension = filename_parts|last|lower %}
              {% endif %}
              
              <tr class="hover:bg-gray-50 transition-colors">
                {# Name with Icon #}
                <td class="px-6 py-4">
                  <div class="flex items-center gap-3">
                    <div class="p-2 rounded-lg {{ type_classes[file_extension]|default('bg-gray-100 text-gray-600') }}">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                        <polyline points="14 2 14 8 20 8"/>
                      </svg>
                    </div>
                    <span class="font-medium text-gray-900">{{ node.title.value }}</span>
                  </div>
                </td>
                
                {# Category #}
                <td class="px-6 py-4">
                  {% if category %}
                    <span class="px-2 py-1 bg-gray-100 rounded text-xs text-gray-600">
                      {{ category.name.value }}
                    </span>
                  {% endif %}
                </td>
                
                {# Date #}
                <td class="px-6 py-4">{{ node.created.value|date('d/m/Y') }}</td>
                
                {# Size #}
                <td class="px-6 py-4">
                  {% if file %}
                    {% set filesize_bytes = file.filesize.value %}
                    {% if filesize_bytes < 1024 %}
                      {{ filesize_bytes }} B
                    {% elseif filesize_bytes < 1048576 %}
                      {{ (filesize_bytes / 1024)|number_format(0) }} KB
                    {% else %}
                      {{ (filesize_bytes / 1048576)|number_format(1) }} MB
                    {% endif %}
                  {% endif %}
                </td>
                
                {# Action #}
                <td class="px-6 py-4 text-right">
                  <div class="flex items-center justify-end gap-3">
                    {% if file %}
                      <a href="{{ file_url(file.uri.value) }}" download class="text-brand-600 hover:text-brand-800 font-medium text-xs uppercase tracking-wide">
                        {{ 'Baixar'|t }}
                      </a>
                    {% endif %}
                    {% if can_edit_content %}
                      <a href="{{ path('entity.node.edit_form', {'node': node.id}) }}" class="text-gray-600 hover:text-gray-900 font-medium text-xs uppercase tracking-wide">
                        {{ 'Editar'|t }}
                      </a>
                    {% endif %}
                  </div>
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                {{ 'Nenhum documento encontrado.'|t }}
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  {# Pager #}
  {% if pager %}
    {{ pager }}
  {% endif %}
  
</div>

